!function(e,t,n){"use strict";var a,r,i,o,l,s,d,c,u,g,f,m,p,h,v,E,b,y,x,N,w,C=n.getElementById("mark"),L=n.getElementById("ui"),S=n.getElementById("ui-file"),T=n.getElementById("ui-themes"),k=n.getElementById("ui-tooltip"),A=!1,B={};a=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){"function"==typeof t&&4===n.readyState&&200===n.status&&t(n.responseText)},n.send()},r=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},n.documentElement.classList?(i=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},l=function(e,t){e.classList.remove(t)}):(i=function(e,t){return RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},o=function(e,t){i(e,t)||(e.className+=(e.className?" ":"")+t)},l=function(e,t){e.className=e.className.replace(RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),"")}),s=function(e){return x[e]},d=function(){for(var e=L.querySelectorAll("[data-l18n]"),t=e.length;t--;)"INPUT"===e[t].tagName?e[t].placeholder=s(e[t].getAttribute("data-l18n")):(e[t].firstChild&&3===e[t].firstChild.nodeType&&e[t].removeChild(e[t].firstChild),e[t].insertBefore(n.createTextNode(s(e[t].getAttribute("data-l18n"))),e[t].firstChild))},c=function(t){var n,a;n=new jsPDF,a=C.getElementsByTagName("textarea")[0],a&&(a=e.render(a)),n.addHTML(C,function(){t.call(void 0,n.output("datauristring")),a&&e.unrender(a)})},u=function(t){var n;n=C.getElementsByTagName("textarea")[0],n&&(n=e.render(n)),html2canvas(C,{onrendered:function(a){t.call(void 0,a.toDataURL()),n&&e.unrender(n)}})},g=function(e){if("TEXTAREA"===e.tagName&&e.selectionStart!==e.selectionEnd){var t,a=n.createElement("div"),r=e.value;return r=r.substring(0,e.selectionStart)+'<span id="selection-rect">'+r.substring(e.selectionStart,e.selectionEnd)+"</span>"+r.substring(e.selectionEnd),a.innerHTML=r.replace(/\n/g,"<br>"),a.className=e.className,e.parentNode.insertBefore(a,e),t=n.getElementById("selection-rect").getBoundingClientRect(),e.parentNode.removeChild(a),t}},f=function(){var t,a,r,i=n.createElement("div");for(i.innerHTML=e.getHTML(),t=i.getElementsByTagName("br"),r=t.length;r--;)t[r].parentNode.replaceChild(n.createTextNode("\n"),t[r]);return a=i.textContent,{characters:a.replace(/\n/g,"").length,words:a.split(/[\s\n]/).filter(function(e){return""!==e}).length}},m=function(e,t){var a,r,i,s=n.getElementById("ui-"+(t?"modal":"notice")),d=function(e){e&&"keydown"===e.type&&27!==e.keyCode||(l(s,"fade-in--show"),n.removeEventListener("keydown",d,!1))},c=s.firstElementChild.firstElementChild,u=s.firstElementChild.lastElementChild;if(c.innerHTML=e,o(s,"fade-in--show"),t){for(a=n.createDocumentFragment();u.firstChild;)u.removeChild(u.firstChild);for(i=t.length;i--;)r=n.createElement("button"),r.textContent=t[i].text,t[i].className&&(r.className=t[i].className),t[i].clickHandler&&r.addEventListener("click",t[i].clickHandler,!1),r.addEventListener("click",d,!1),a.insertBefore(r,a.firstChild);u.appendChild(a),n.addEventListener("keydown",d,!1)}else s.addEventListener("click",d,!1),setTimeout(d,8e3);return s},p=function(){var t=e.getText();return"<br>"!==t&&N!==t},h=function(e,t,a,r){var i=n.createElement("a");void 0!==i.download?(i.href=r?e:"data:"+a+";charset=utf-8,"+encodeURIComponent(e),i.download=s("export-filename")+"."+t,n.body.appendChild(i),i.click(),n.body.removeChild(i)):navigator.onLine&&(i.innerHTML='<form method="POST" action="server/download-fallback.php"><input type="hidden" name="content" value="'+e+'"><input type="hidden" name="extension" value="'+t+'"><input type="hidden" name="mime-type" value="'+a+'"><input type="hidden" name="filename" value="'+s("export-filename")+'"><input type="hidden" name="data-url" value="'+(r||!1)+'"></form>',n.body.appendChild(i),i.firstChild.submit(),n.body.removeChild(i))},v=function(t){switch(N=e.getText(),t){case"txt":h(N,"txt","text/plain");break;case"html":h(e.getHTML(),"html","text/html");break;case"pdf":c(function(e){h(e,"pdf","application/pdf",!0)});break;case"png":u(function(e){h(e,"png","image/png",!0)})}},E=function(t){for(var n,a;C.firstChild;)C.removeChild(C.firstChild);if(t)for(n=e.convert(t),a=n.length;a--;)C.insertBefore(n[a],C.firstChild);else e.newline()},b=function(e){if(!FileReader)return void m(s("feature-not-supported"));var t,n=new FileReader,a=e.name.split(".").pop().toUpperCase();"text/plain"===e.type||"MD"===a||"MARKDOWN"===a?(n.onload=function(){t=n.result,p()?m(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){E(t)}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),E(t)},className:"button--active"}]):E(t)},n.readAsText(e)):m(s("file-type-not-supported"))},y=function(t,n){var a=new XMLHttpRequest;N=e.getText(),a.open("POST","server/mail.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.onload=function(){4===a.readyState&&200===a.status&&m(s("success"===a.responseText?"mail-sent":"mail-error"))},a.send("address="+t+"&message="+(encodeURIComponent(n)||s("mail-default-message"))+"\n\n---\n"+s("mail-footnote")+"&attachment="+encodeURIComponent(N)+"&subject="+s("mail-subject")+"&filename="+s("export-filename"))},e.init(C),a("languages/languages.json",function(e){for(var t,r=JSON.parse(e),i=navigator.onLine?localStorage.languageFile:r[0].file,o=n.getElementById("ui-languages-list"),l=r.length,s=n.createDocumentFragment(),c=function(){var e=this;a(e.getAttribute("data-file"),function(t){localStorage.languageFile=e.getAttribute("data-file"),localStorage.languageDictionary=e.getAttribute("data-dictionary"),x=JSON.parse(t),d()})};l--;)t=n.createElement("li"),t.setAttribute("data-file",r[l].file),t.setAttribute("data-dictionary",r[l].dictionary||""),t.textContent=r[l].name,t.addEventListener("click",c,!1),s.insertBefore(t,s.firstChild),i||-1===r[l].identifiers.indexOf((navigator.language||navigator.userLanguage).toLowerCase())&&l||(localStorage.languageFile=i=r[l].file,localStorage.languageDictionary=r[l].dictionary);o.insertBefore(s,o.firstChild),a(i,function(e){x=JSON.parse(e),d()})}),a("themes/themes.json",function(a){var r,i=JSON.parse(a),s=navigator.onLine?i.length:1,d=n.createDocumentFragment(),c=n.createElement("link"),u=function(){var e=this;localStorage.themeFile=e.getAttribute("data-file"),localStorage.themeUi=e.getAttribute("data-ui"),n.getElementById("theme").href=localStorage.themeFile,l(L,"ui-"+("dark"===localStorage.themeUi?"light":"dark")),o(L,"ui-"+localStorage.themeUi),e.parentNode.getElementsByClassName("active-theme")[0].removeAttribute("class"),e.className="active-theme"},g=function(){o(L,"ui-"+localStorage.themeUi),localStorage.saveState&&"<br>"!==localStorage.saveState?E(localStorage.saveState):e.newline(),c.removeEventListener("load",g,!1)};for(localStorage.themeFile&&navigator.onLine||(localStorage.themeFile=i[0].folder+"theme.css",localStorage.themeUi=i[0].ui),c.id="theme",c.rel="stylesheet",c.href=localStorage.themeFile,c.addEventListener("load",g,!1),n.head.appendChild(c);s--;)r=n.createElement("li"),r.setAttribute("data-file",i[s].folder+"theme.css"),r.setAttribute("data-fonts",i[s].fonts.join(",")),r.setAttribute("data-ui",i[s].ui),r.style.backgroundImage='url("'+i[s].folder+"preview"+(navigator.onLine&&t.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx)").matches?"@2x":"")+'.png")',r.textContent=i[s].name,r.getAttribute("data-file")===localStorage.themeFile&&(r.className="active-theme"),r.addEventListener("click",u,!1),d.insertBefore(r,d.firstChild);n.getElementById("ui-themes-list").appendChild(d)}),t.addEventListener("unload",function(){localStorage.saveState=e.getText()},!1),navigator.onLine||o(n.body,"offline"),t.addEventListener("offline",function(){o(n.body,"offline")},!1),t.addEventListener("online",function(){l(n.body,"offline")},!1),S.addEventListener("click",function(e){if(navigator.onLine||!i(e.target,"online-only"))if(e.target.id)switch(l(L.parentNode,"frame--show-file"),e.target.id){case"ui-export-txt":v("txt");break;case"ui-export-html":v("html");break;case"ui-export-pdf":setTimeout(function(){v("pdf")},300);break;case"ui-export-png":setTimeout(function(){v("png")},300);break;case"ui-new":p()?m(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){E()}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),E()},className:"button--active"}]):E();break;case"ui-mail":m('<label class="font-caps" for="ui-mail-email">'+s("mail-address")+'</label><input id="ui-mail-email" class="font-helvetica font-size-regular" type="email" value="'+(localStorage.email||"")+'"><label class="font-caps" for="ui-mail-message">'+s("mail-text")+'</label><textarea id="ui-mail-message" class="font-helvetica font-size-regular"></textarea>',[{text:s("cancel")},{text:s("send"),clickHandler:function(e){var t=n.getElementById("ui-mail-email");/\S+@\S+\.\S+/.test(t.value)?(l(t,"validation-error"),localStorage.email=t.value,y(t.value,n.getElementById("ui-mail-message").value)):(e.stopImmediatePropagation(),o(t,"validation-error"))},className:"button--active"}]);break;case"ui-about":p()?m(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){E(s("about-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),E(s("about-text"))},className:"button--active"}]):E(s("about-text"))}else i(e.target,"menu__sublist")?(o(e.target,"menu__sublist--display"),o(e.target.parentNode,"menu__list--display-sublist")):i(e.target,"menu__back")&&(l(e.target.parentNode.parentNode,"menu__sublist--display"),l(e.target.parentNode.parentNode.parentNode,"menu__list--display-sublist"))},!1),n.getElementById("ui-custom-theme").addEventListener("click",function(){l(L.parentNode,"frame--show-themes"),p()?m(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){E(s("create-a-custom-theme-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),E(s("create-a-custom-theme-text"))},className:"button--active"}]):E(s("create-a-custom-theme-text"))},!1),n.getElementById("ui-themes-filter").addEventListener("input",function(){for(var e=this,t=e.nextElementSibling,n=t.children.length,a=0;n--;)-1!==t.children[n].textContent.toLowerCase().indexOf(e.value.toLowerCase())||-1!==t.children[n].getAttribute("data-fonts").toLowerCase().indexOf(e.value.toLowerCase())?(t.children[n].style.display="block",a++):t.children[n].style.display="none";t.nextElementSibling.style.display=a?"none":"block"},!1),n.getElementById("ui-open").addEventListener("change",function(){b(this.files[0]),this.parentNode.reset()},!1),n.addEventListener("dragover",function(e){"TEXTAREA"!==e.target.tagName&&e.preventDefault()},!1),n.addEventListener("dragenter",function(e){"TEXTAREA"!==e.target.tagName&&o(C,"dragover")},!1),n.addEventListener("dragleave",function(e){e.target===C&&l(C,"dragover")},!1),n.addEventListener("drop",function(t){if("TEXTAREA"!==t.target.tagName){t.preventDefault();var n,a,r;t.dataTransfer.files[0]?b(t.dataTransfer.files[0]):(r=t.dataTransfer.getData("URL")||t.dataTransfer.getData("TEXT"),a=C.getElementsByTagName("TEXTAREA")[0]||C,r&&(n=r.split(".").pop().toUpperCase(),("BMP"===n||"GIF"===n||"JPG"===n||"JPEG"===n||"PNG"===n||"SVG"===n)&&(r="![]("+r+")"),"TEXTAREA"===a.tagName?a.value+=r:e.newline(r))),l(C,"dragover")}},!1),C.addEventListener("select",function(e){if(localStorage.languageDictionary&&"TEXTAREA"===e.target.tagName){var i=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd).trim();(i.match(/\s/g)||[]).length<2&&i.length>1&&i.length<20&&a("server/sinonimi/service.php?word="+encodeURIComponent(i)+"&language="+localStorage.languageDictionary+"&output=json",function(a){if(a=JSON.parse(a),a.response){var i,s,d={},c=g(e.target),u=function(){l(k.parentNode,"fade-in--show"),n.removeEventListener("keydown",u,!1),n.removeEventListener("mouseup",u,!1),n.removeEventListener("drop",u,!1),C.removeEventListener("scroll",u,!1)},f=a.response.length,m="";for(s=0;f>s;s++)d.hasOwnProperty(a.response[s].list.category)||(d[a.response[s].list.category]=[]),d[a.response[s].list.category]=r(d[a.response[s].list.category].concat(a.response[s].list.synonyms.replace(/\s\(\w+\)/g,"").split("|")));m+='<div class="tooltip__container scroll">';for(i in d)d.hasOwnProperty(i)&&(m+='<span class="tooltip__category font-caps">'+i.replace(/[\(\)]/g,"")+"</span>",m+='<ul class="font-size-medium no-bullets"><li>'+d[i].join("</li><li>")+"</li></ul>");m+="</div>",n.addEventListener("keydown",u,!1),n.addEventListener("mouseup",u,!1),n.addEventListener("drop",u,!1),C.addEventListener("scroll",u,!1),k.innerHTML=m,k.style.left=c.left+c.width/2-k.offsetWidth/2+"px",c.top+k.offsetHeight+50>t.innerHeight?(o(k,"tooltip--top"),k.style.top=c.top-c.height-k.offsetHeight+"px"):(l(k,"tooltip--top"),k.style.top=c.top+c.height+"px"),o(k.parentNode,"fade-in--show")}})}},!1),k.addEventListener("mouseup",function(e){var t,n;"LI"===e.target.tagName&&(t=C.getElementsByTagName("TEXTAREA")[0],n=t.selectionStart,t.value=t.value.substring(0,n)+e.target.textContent+t.value.substring(t.selectionEnd),t.setSelectionRange(n+e.target.textContent.length,n+e.target.textContent.length))},!1),t.hasOwnProperty("ontouchstart")||navigator.msMaxTouchPoints?(o(n.body,"touch"),n.addEventListener("touchstart",function(e){B.x=e.changedTouches[0].pageX,B.y=e.changedTouches[0].pageY},!1),n.addEventListener("touchend",function(e){var t=B.x-e.changedTouches[0].pageX,n=B.y-e.changedTouches[0].pageY;Math.abs(t)>Math.abs(n)&&(t>0?i(L.parentNode,"frame--show-file")?l(L.parentNode,"frame--show-file"):o(L.parentNode,"frame--show-themes"):i(L.parentNode,"frame--show-themes")?l(L.parentNode,"frame--show-themes"):o(L.parentNode,"frame--show-file"))},!1)):(o(n.body,-1!==navigator.appVersion.indexOf("Mac")?"os-mac":"os-other"),S.addEventListener("mouseenter",function(){var e=f();n.getElementById("ui-counter-characters").textContent=e.characters,n.getElementById("ui-counter-words").textContent=e.words,o(L.parentNode,"frame--show-file")},!1),S.addEventListener("mouseleave",function(){var e=this.getElementsByClassName("menu__list--display-sublist")[0];e&&(l(e,"menu__list--display-sublist"),l(e.getElementsByClassName("menu__sublist--display")[0],"menu__sublist--display")),l(L.parentNode,"frame--show-file")},!1),T.addEventListener("mouseenter",function(){o(L.parentNode,"frame--show-themes")},!1),T.addEventListener("mouseleave",function(){l(L.parentNode,"frame--show-themes")},!1),n.addEventListener("mousemove",function(){A||(o(L.parentNode,"mouse-moved"),A=!0),clearTimeout(w),w=setTimeout(function(){l(L.parentNode,"mouse-moved"),A=!1},1e3)},!1),n.addEventListener("keydown",function(e){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case 69:e.preventDefault(),v(e.altKey&&e.shiftKey?"png":e.altKey?"html":e.shiftKey?"pdf":"txt");break;case 68:e.preventDefault(),n.getElementById("ui-new").click();break;case 77:e.preventDefault(),n.getElementById("ui-mail").click();break;case 83:e.preventDefault(),m(s("save-notification"))}},!1))}(Mark,window,document);