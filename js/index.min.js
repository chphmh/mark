!function(e,t,n){"use strict";var a,i,r,o,l,s,d,c,u,m,g,f,h,p,v,y,x,E,b,N,S,L=n.getElementById("mark"),C=n.getElementById("ui"),T=n.getElementById("ui-file"),w=n.getElementById("ui-themes"),k=n.getElementById("ui-tooltip"),H=!1,F={};a=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){"function"==typeof t&&4===n.readyState&&200===n.status&&t(n.responseText)},n.send()},i=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},n.documentElement.classList?(r=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},l=function(e,t){e.classList.remove(t)}):(r=function(e,t){return RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},o=function(e,t){r(e,t)||(e.className+=(e.className?" ":"")+t)},l=function(e,t){e.className=e.className.replace(RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),"")}),s=function(e){return b[e]},d=function(){for(var e=C.querySelectorAll("[data-l18n]"),t=e.length;t--;)"INPUT"===e[t].tagName?e[t].placeholder=s(e[t].getAttribute("data-l18n")):(e[t].firstChild&&3===e[t].firstChild.nodeType&&e[t].removeChild(e[t].firstChild),e[t].insertBefore(n.createTextNode(s(e[t].getAttribute("data-l18n"))),e[t].firstChild))},c=function(e,t){var n,a;for(a=0;a<t.childNodes.length;a++)if(e.y+e.margin>297&&(e.y=e.margin+e.lineHeight,e.addPage()),3===t.childNodes[a].nodeType)"\n"!==t.childNodes[a].textContent&&(n=e.splitTextToSize(t.childNodes[a].textContent,210-e.margin-e.x),e.text(e.x,e.y,n[0]),"A"===t.tagName&&(e.setDrawColor(0,0,255),e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y+e.lineHeight/8),e.setDrawColor(0,0,0)),"DEL"===t.tagName&&e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y-e.lineHeight/4),n.length>1?(t.childNodes[a].textContent=t.childNodes[a].textContent.substring(n[0].length).replace(/^\s/,""),e.y+=e.lineHeight,e.x=e.margin,a--):(e.x+=e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal"),e.setTextColor(0,0,0)));else{switch(t.childNodes[a].tagName){case"H1":e.setFontSize(24),e.setFontStyle("bold");break;case"H2":e.setFontSize(18),e.setFontStyle("bold");break;case"H3":e.setFontSize(14),e.setFontStyle("bold");break;case"H4":case"H5":case"H6":e.setFontStyle("bold");break;case"HR":e.lines([[0,0],[210-2*e.margin,0]],e.margin,e.y-e.lineHeight/1.5),e.y+=e.lineHeight,e.x=e.margin;break;case"LI":"UL"===t.tagName?(e.setFillColor(0,0,0),e.circle(e.margin-5,e.y-e.lineHeight/4,.7,"F")):e.text(e.x-6,e.y,Array.prototype.indexOf.call(t.children,t.childNodes[a])+1+".");break;case"EM":e.setFontStyle("italic");break;case"STRONG":e.setFontStyle("bold");break;case"A":e.setTextColor(0,0,255);break;case"CODE":e.setFont("courier"),e.setFontSize(10);break;case"IMG":e.text(e.x,e.y,t.childNodes[a].alt||t.childNodes[a].src),e.x+=e.getStringUnitWidth(t.childNodes[a].alt||t.childNodes[a].src)*e.internal.getFontSize()/e.internal.scaleFactor;break;default:e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal")}c(e,t.childNodes[a]),t.childNodes[a].tagName.match(/P|H1|H2|H3|H4|H5|H6|LI/)&&(e.y+="LI"===t.childNodes[a].tagName&&t.childNodes[a].nextElementSibling?e.lineHeight:2*e.lineHeight,e.x=e.margin)}},u=function(){var t,n=new jsPDF,a=L.getElementsByTagName("TEXTAREA")[0];return a&&e.render(a),t=L.cloneNode(!0),n.lineHeight=5.29,n.margin=20,n.x=n.margin,n.y=n.margin+n.lineHeight,n.setProperties({title:s("export-filename"),author:"Mark",creator:"Mark"}),c(n,t),n.output("datauristring")},m=function(e){if("TEXTAREA"===e.tagName&&e.selectionStart!==e.selectionEnd){var t,a=n.createElement("div"),i=e.value;return i=i.substring(0,e.selectionStart)+'<span id="selection-rect">'+i.substring(e.selectionStart,e.selectionEnd)+"</span>"+i.substring(e.selectionEnd),a.innerHTML=i.replace(/\n/g,"<br>"),a.className=e.className,e.parentNode.insertBefore(a,e),t=n.getElementById("selection-rect").getBoundingClientRect(),e.parentNode.removeChild(a),t}},g=function(){var t,a,i,r=n.createElement("div");for(r.innerHTML=e.getHTML(),t=r.getElementsByTagName("br"),i=t.length;i--;)t[i].parentNode.replaceChild(n.createTextNode("\n"),t[i]);return a=r.textContent,{characters:a.replace(/\n/g,"").length,words:a.split(/[\s\n]/).filter(function(e){return""!==e}).length}},f=function(e,t){var a,i,r,s=n.getElementById("ui-"+(t?"modal":"notice")),d=function(e){e&&"keydown"===e.type&&27!==e.keyCode||(l(s,"fade-in--show"),n.removeEventListener("keydown",d,!1))},c=s.firstElementChild.firstElementChild,u=s.firstElementChild.lastElementChild;if(c.innerHTML=e,o(s,"fade-in--show"),t){for(a=n.createDocumentFragment();u.firstChild;)u.removeChild(u.firstChild);for(r=t.length;r--;)i=n.createElement("button"),i.textContent=t[r].text,t[r].className&&(i.className=t[r].className),t[r].clickHandler&&i.addEventListener("click",t[r].clickHandler,!1),i.addEventListener("click",d,!1),a.insertBefore(i,a.firstChild);u.appendChild(a),n.addEventListener("keydown",d,!1)}else s.addEventListener("click",d,!1),setTimeout(d,8e3);return s},h=function(){var t=e.getText();return"<br>"!==t&&N!==t},p=function(e,t,a,i){var r=n.createElement("a");void 0!==r.download?(r.href=i?e:"data:"+a+";charset=utf-8,"+encodeURIComponent(e),r.download=s("export-filename")+"."+t,n.body.appendChild(r),r.click(),n.body.removeChild(r)):navigator.onLine&&(r.innerHTML='<form method="POST" action="server/download-fallback.php"><input type="hidden" name="content" value="'+e.replace(/"/g,"&quot;")+'"><input type="hidden" name="extension" value="'+t+'"><input type="hidden" name="mime-type" value="'+a+'"><input type="hidden" name="filename" value="'+s("export-filename")+'"><input type="hidden" name="data-url" value="'+(i||!1)+'"></form>',n.body.appendChild(r),r.firstChild.submit(),n.body.removeChild(r))},v=function(t){switch(N=e.getText(),t){case"txt":p(N,"txt","text/plain");break;case"html":p(e.getHTML(),"html","text/html");break;case"pdf":u(),p(u(),"pdf","application/pdf",!0)}},y=function(t){for(var n,a;L.firstChild;)L.removeChild(L.firstChild);if(t)for(n=e.convert(t),a=n.length;a--;)L.insertBefore(n[a],L.firstChild);else e.newline()},x=function(e){if(!FileReader)return void f(s("feature-not-supported"));var t,n=new FileReader,a=e.name.split(".").pop().toUpperCase();"text/plain"===e.type||"MD"===a||"MARKDOWN"===a?(n.onload=function(){t=n.result,h()?f(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(t)}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(t)},className:"button--active"}]):y(t)},n.readAsText(e)):f(s("file-type-not-supported"))},E=function(t,n){var a=new XMLHttpRequest;N=e.getText(),a.open("POST","server/mail.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.onload=function(){4===a.readyState&&200===a.status&&f(s("success"===a.responseText?"mail-sent":"mail-error"))},a.send("address="+t+"&message="+(encodeURIComponent(n)||s("mail-default-message"))+"\n\n---\n"+s("mail-footnote")+"&attachment="+encodeURIComponent(N)+"&subject="+s("mail-subject")+"&filename="+s("export-filename"))},e.init(L),a("languages/languages.json",function(e){for(var t,i=JSON.parse(e),r=navigator.onLine?localStorage.languageFile:i[0].file,o=n.getElementById("ui-languages-list"),l=i.length,s=n.createDocumentFragment(),c=function(){var e=this;a(e.getAttribute("data-file"),function(t){localStorage.languageFile=e.getAttribute("data-file"),localStorage.languageDictionary=e.getAttribute("data-dictionary"),b=JSON.parse(t),d()})};l--;)t=n.createElement("li"),t.setAttribute("data-file",i[l].file),t.setAttribute("data-dictionary",i[l].dictionary||""),t.textContent=i[l].name,t.addEventListener("click",c,!1),s.insertBefore(t,s.firstChild),r||-1===i[l].identifiers.indexOf((navigator.language||navigator.userLanguage).toLowerCase())&&l||(localStorage.languageFile=r=i[l].file,localStorage.languageDictionary=i[l].dictionary);o.insertBefore(s,o.firstChild),a(r,function(e){b=JSON.parse(e),d()})}),a("themes/themes.json",function(a){var i,r=JSON.parse(a),s=navigator.onLine?r.length:1,d=n.createDocumentFragment(),c=n.createElement("link"),u=function(){var e=this;localStorage.themeFile=e.getAttribute("data-file"),localStorage.themeUi=e.getAttribute("data-ui"),n.getElementById("theme").href=localStorage.themeFile,l(C,"ui-"+("dark"===localStorage.themeUi?"light":"dark")),o(C,"ui-"+localStorage.themeUi),e.parentNode.getElementsByClassName("active-theme")[0].removeAttribute("class"),e.className="active-theme"},m=function(){o(C,"ui-"+localStorage.themeUi),localStorage.saveState&&"<br>"!==localStorage.saveState?y(localStorage.saveState):e.newline(),c.removeEventListener("load",m,!1)};for(localStorage.themeFile&&navigator.onLine||(localStorage.themeFile=r[0].folder+"theme.css",localStorage.themeUi=r[0].ui),c.id="theme",c.rel="stylesheet",c.href=localStorage.themeFile,c.addEventListener("load",m,!1),n.head.appendChild(c);s--;)i=n.createElement("li"),i.setAttribute("data-file",r[s].folder+"theme.css"),i.setAttribute("data-fonts",r[s].fonts.join(",")),i.setAttribute("data-ui",r[s].ui),i.style.backgroundImage='url("'+r[s].folder+"preview"+(navigator.onLine&&t.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx)").matches?"@2x":"")+'.png")',i.textContent=r[s].name,i.getAttribute("data-file")===localStorage.themeFile&&(i.className="active-theme"),i.addEventListener("click",u,!1),d.insertBefore(i,d.firstChild);n.getElementById("ui-themes-list").appendChild(d)}),t.addEventListener("unload",function(){localStorage.saveState=e.getText()},!1),navigator.onLine||o(n.body,"offline"),t.addEventListener("offline",function(){o(n.body,"offline")},!1),t.addEventListener("online",function(){l(n.body,"offline")},!1),T.addEventListener("click",function(e){if(navigator.onLine||!r(e.target,"online-only"))if(e.target.id)switch(l(C.parentNode,"frame--show-file"),e.target.id){case"ui-export-txt":v("txt");break;case"ui-export-html":v("html");break;case"ui-export-pdf":setTimeout(function(){v("pdf")},300);break;case"ui-new":h()?f(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y()}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y()},className:"button--active"}]):y();break;case"ui-mail":f('<label class="font-caps" for="ui-mail-email">'+s("mail-address")+'</label><input id="ui-mail-email" class="font-helvetica font-size-regular" type="email" value="'+(localStorage.email||"")+'"><label class="font-caps" for="ui-mail-message">'+s("mail-text")+'</label><textarea id="ui-mail-message" class="font-helvetica font-size-regular"></textarea>',[{text:s("cancel")},{text:s("send"),clickHandler:function(e){var t=n.getElementById("ui-mail-email");/\S+@\S+\.\S+/.test(t.value)?(l(t,"validation-error"),localStorage.email=t.value,E(t.value,n.getElementById("ui-mail-message").value)):(e.stopImmediatePropagation(),o(t,"validation-error"))},className:"button--active"}]);break;case"ui-about":h()?f(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(s("about-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(s("about-text"))},className:"button--active"}]):y(s("about-text"))}else r(e.target,"menu__sublist")?(o(e.target,"menu__sublist--display"),o(e.target.parentNode,"menu__list--display-sublist")):r(e.target,"menu__back")&&(l(e.target.parentNode.parentNode,"menu__sublist--display"),l(e.target.parentNode.parentNode.parentNode,"menu__list--display-sublist"))},!1),n.getElementById("ui-custom-theme").addEventListener("click",function(){l(C.parentNode,"frame--show-themes"),h()?f(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(s("create-a-custom-theme-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(s("create-a-custom-theme-text"))},className:"button--active"}]):y(s("create-a-custom-theme-text"))},!1),n.getElementById("ui-themes-filter").addEventListener("input",function(){for(var e=this,t=e.nextElementSibling,n=t.children.length,a=0;n--;)-1!==t.children[n].textContent.toLowerCase().indexOf(e.value.toLowerCase())||-1!==t.children[n].getAttribute("data-fonts").toLowerCase().indexOf(e.value.toLowerCase())?(t.children[n].style.display="block",a++):t.children[n].style.display="none";t.nextElementSibling.style.display=a?"none":"block"},!1),n.getElementById("ui-open").addEventListener("change",function(){x(this.files[0]),this.parentNode.reset()},!1),n.addEventListener("dragover",function(e){"TEXTAREA"!==e.target.tagName&&e.preventDefault()},!1),n.addEventListener("dragenter",function(e){"TEXTAREA"!==e.target.tagName&&o(L,"dragover")},!1),n.addEventListener("dragleave",function(e){e.target===L&&l(L,"dragover")},!1),n.addEventListener("drop",function(t){if("TEXTAREA"!==t.target.tagName){t.preventDefault();var n,a,i;t.dataTransfer.files[0]?x(t.dataTransfer.files[0]):(i=t.dataTransfer.getData("URL")||t.dataTransfer.getData("TEXT"),a=L.getElementsByTagName("TEXTAREA")[0]||L,i&&(n=i.split(".").pop().toUpperCase(),n.match(/BMP|GIF|JPG|JPEG|PNG|SVG/)&&(i="![]("+i+")"),"TEXTAREA"===a.tagName?a.value+=i:e.newline(i))),l(L,"dragover")}},!1),L.addEventListener("select",function(e){if(localStorage.languageDictionary&&"TEXTAREA"===e.target.tagName){var r=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd).trim();(r.match(/\s/g)||[]).length<2&&r.length>1&&r.length<20&&a("server/sinonimi/service.php?word="+encodeURIComponent(r)+"&language="+localStorage.languageDictionary+"&output=json",function(a){if(a=JSON.parse(a),a.response){var r,s,d={},c=m(e.target),u=function(){l(k.parentNode,"fade-in--show"),n.removeEventListener("keydown",u,!1),n.removeEventListener("mouseup",u,!1),n.removeEventListener("drop",u,!1),L.removeEventListener("scroll",u,!1)},g=a.response.length,f="";for(s=0;g>s;s++)d.hasOwnProperty(a.response[s].list.category)||(d[a.response[s].list.category]=[]),d[a.response[s].list.category]=i(d[a.response[s].list.category].concat(a.response[s].list.synonyms.replace(/\s\(\w+\)/g,"").split("|")));f+='<div class="tooltip__container scroll">';for(r in d)d.hasOwnProperty(r)&&(f+='<span class="tooltip__category font-caps">'+r.replace(/[\(\)]/g,"")+"</span>",f+='<ul class="font-size-medium no-bullets"><li>'+d[r].join("</li><li>")+"</li></ul>");f+="</div>",n.addEventListener("keydown",u,!1),n.addEventListener("mouseup",u,!1),n.addEventListener("drop",u,!1),L.addEventListener("scroll",u,!1),k.innerHTML=f,k.style.left=c.left+c.width/2-k.offsetWidth/2+"px",c.top+k.offsetHeight+50>t.innerHeight?(o(k,"tooltip--top"),k.style.top=c.top-c.height-k.offsetHeight+"px"):(l(k,"tooltip--top"),k.style.top=c.top+c.height+"px"),o(k.parentNode,"fade-in--show")}})}},!1),k.addEventListener("mouseup",function(e){var t,n;"LI"===e.target.tagName&&(t=L.getElementsByTagName("TEXTAREA")[0],n=t.selectionStart,t.value=t.value.substring(0,n)+e.target.textContent+t.value.substring(t.selectionEnd),t.setSelectionRange(n+e.target.textContent.length,n+e.target.textContent.length))},!1),t.hasOwnProperty("ontouchstart")||navigator.msMaxTouchPoints?(o(n.body,"touch"),n.addEventListener("touchstart",function(e){F.x=e.changedTouches[0].pageX,F.y=e.changedTouches[0].pageY},!1),n.addEventListener("touchend",function(e){var t=F.x-e.changedTouches[0].pageX,n=F.y-e.changedTouches[0].pageY;Math.abs(t)>Math.abs(n)&&(t>0?r(C.parentNode,"frame--show-file")?l(C.parentNode,"frame--show-file"):o(C.parentNode,"frame--show-themes"):r(C.parentNode,"frame--show-themes")?l(C.parentNode,"frame--show-themes"):o(C.parentNode,"frame--show-file"))},!1)):(o(n.body,-1!==navigator.appVersion.indexOf("Mac")?"os-mac":"os-other"),T.addEventListener("mouseenter",function(){var e=g();n.getElementById("ui-counter-characters").textContent=e.characters,n.getElementById("ui-counter-words").textContent=e.words,o(C.parentNode,"frame--show-file")},!1),T.addEventListener("mouseleave",function(){var e=this.getElementsByClassName("menu__list--display-sublist")[0];e&&(l(e,"menu__list--display-sublist"),l(e.getElementsByClassName("menu__sublist--display")[0],"menu__sublist--display")),l(C.parentNode,"frame--show-file")},!1),w.addEventListener("mouseenter",function(){o(C.parentNode,"frame--show-themes")},!1),w.addEventListener("mouseleave",function(){l(C.parentNode,"frame--show-themes")},!1),n.addEventListener("mousemove",function(){H||(o(C.parentNode,"mouse-moved"),H=!0),clearTimeout(S),S=setTimeout(function(){l(C.parentNode,"mouse-moved"),H=!1},1e3)},!1),n.addEventListener("keydown",function(e){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case 69:e.preventDefault(),v(e.altKey?"html":e.shiftKey?"pdf":"txt");break;case 68:e.preventDefault(),n.getElementById("ui-new").click();break;case 77:e.preventDefault(),n.getElementById("ui-mail").click();break;case 83:e.preventDefault(),f(s("save-notification"))}},!1))}(Mark,window,document);