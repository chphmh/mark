!function(e,t,n){"use strict";var a,i,r,o,l,s,c,d,u,g,m,f,h,p,v,y,x,E,b,N,S,C,L=n.getElementById("mark"),w=n.getElementById("ui"),T=n.getElementById("ui-file"),k=n.getElementById("ui-themes"),H=n.getElementById("ui-tooltip"),F=!1,A={};a=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){"function"==typeof t&&4===n.readyState&&200===n.status&&t(n.responseText)},n.send()},i=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},n.documentElement.classList?(r=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},l=function(e,t){e.classList.remove(t)}):(r=function(e,t){return RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},o=function(e,t){r(e,t)||(e.className+=(e.className?" ":"")+t)},l=function(e,t){e.className=e.className.replace(RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),"")}),s=function(e){return N[e]},c=function(){for(var e=w.querySelectorAll("[data-l18n]"),t=e.length;t--;)"INPUT"===e[t].tagName?e[t].placeholder=s(e[t].getAttribute("data-l18n")):(e[t].firstChild&&3===e[t].firstChild.nodeType&&e[t].removeChild(e[t].firstChild),e[t].insertBefore(n.createTextNode(s(e[t].getAttribute("data-l18n"))),e[t].firstChild))},d=function(e,t){var n,a;for(a=0;a<t.childNodes.length;a++)if(e.y+e.margin>297&&(e.y=e.margin+e.lineHeight,e.addPage()),3===t.childNodes[a].nodeType)"\n"!==t.childNodes[a].textContent&&(n=e.splitTextToSize(t.childNodes[a].textContent,210-e.margin-e.x),e.text(e.x,e.y,n[0]),"A"===t.tagName&&(e.setDrawColor(0,0,255),e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y+e.lineHeight/8),e.setDrawColor(0,0,0)),"DEL"===t.tagName&&e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y-e.lineHeight/4),n.length>1?(t.childNodes[a].textContent=t.childNodes[a].textContent.substring(n[0].length).replace(/^\s/,""),e.y+=e.lineHeight,e.x=e.margin,a--):(e.x+=e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal"),e.setTextColor(0,0,0)));else{switch(t.childNodes[a].tagName){case"H1":e.setFontSize(24),e.setFontStyle("bold");break;case"H2":e.setFontSize(18),e.setFontStyle("bold");break;case"H3":e.setFontSize(14),e.setFontStyle("bold");break;case"H4":case"H5":case"H6":e.setFontStyle("bold");break;case"HR":e.lines([[0,0],[210-2*e.margin,0]],e.margin,e.y-e.lineHeight/1.5),e.y+=e.lineHeight,e.x=e.margin;break;case"LI":"UL"===t.tagName?(e.setFillColor(0,0,0),e.circle(e.margin-5,e.y-e.lineHeight/4,.7,"F")):e.text(e.x-6,e.y,Array.prototype.indexOf.call(t.children,t.childNodes[a])+1+".");break;case"EM":e.setFontStyle("italic");break;case"STRONG":e.setFontStyle("bold");break;case"A":e.setTextColor(0,0,255);break;case"CODE":e.setFont("courier"),e.setFontSize(10);break;case"IMG":e.text(e.x,e.y,t.childNodes[a].alt||t.childNodes[a].src),e.x+=e.getStringUnitWidth(t.childNodes[a].alt||t.childNodes[a].src)*e.internal.getFontSize()/e.internal.scaleFactor;break;default:e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal")}d(e,t.childNodes[a]),t.childNodes[a].tagName.match(/P|H1|H2|H3|H4|H5|H6|LI/)&&(e.y+="LI"===t.childNodes[a].tagName&&t.childNodes[a].nextElementSibling?e.lineHeight:2*e.lineHeight,e.x=e.margin)}},u=function(){var t,n=new jsPDF,a=L.getElementsByTagName("TEXTAREA")[0];return a&&e.render(a),t=L.cloneNode(!0),n.lineHeight=5.29,n.margin=20,n.x=n.margin,n.y=n.margin+n.lineHeight,n.setProperties({title:f(),author:"Mark",creator:"Mark"}),d(n,t),n.output("datauristring")},g=function(e){if("TEXTAREA"===e.tagName&&e.selectionStart!==e.selectionEnd){var t,a=n.createElement("div"),i=e.value;return i=i.substring(0,e.selectionStart)+'<span id="selection-rect">'+i.substring(e.selectionStart,e.selectionEnd)+"</span>"+i.substring(e.selectionEnd),a.innerHTML=i.replace(/\n/g,"<br>"),a.className=e.className,e.parentNode.insertBefore(a,e),t=n.getElementById("selection-rect").getBoundingClientRect(),e.parentNode.removeChild(a),t}},m=function(){var t,a,i,r=n.createElement("div");for(r.innerHTML=e.getHTML(),t=r.getElementsByTagName("br"),i=t.length;i--;)t[i].parentNode.replaceChild(n.createTextNode("\n"),t[i]);return a=r.textContent,{characters:a.replace(/\n/g,"").length,words:a.split(/[\s\n]/).filter(function(e){return""!==e}).length}},f=function(e){var t;return"H1"===L.firstChild.tagName&&L.firstChild.textContent?(t=L.firstChild.textContent,e&&(t=t.toLowerCase().replace(/\s/g,"-"))):t=s("default-filename"),t},h=function(e,t){var a,i,r,s=n.getElementById("ui-"+(t?"modal":"notice")),c=function(e){e&&"keydown"===e.type&&27!==e.keyCode||(l(s,"fade-in--show"),n.removeEventListener("keydown",c,!1))},d=s.firstElementChild.firstElementChild,u=s.firstElementChild.lastElementChild;if(d.innerHTML=e,o(s,"fade-in--show"),t){for(a=n.createDocumentFragment();u.firstChild;)u.removeChild(u.firstChild);for(r=t.length;r--;)i=n.createElement("button"),i.textContent=t[r].text,t[r].className&&(i.className=t[r].className),t[r].clickHandler&&i.addEventListener("click",t[r].clickHandler,!1),i.addEventListener("click",c,!1),a.insertBefore(i,a.firstChild);u.appendChild(a),n.addEventListener("keydown",c,!1)}else s.addEventListener("click",c,!1),setTimeout(c,8e3);return s},p=function(){var t=e.getText();return"<br>"!==t&&S!==t},v=function(e,t,a,i){var r=n.createElement("a");void 0!==r.download?(r.href=i?e:"data:"+a+";charset=utf-8,"+encodeURIComponent(e),r.download=f(!0)+"."+t,n.body.appendChild(r),r.click(),n.body.removeChild(r)):navigator.onLine&&(r.innerHTML='<form method="POST" action="server/download-fallback.php"><input type="hidden" name="content" value="'+e.replace(/"/g,"&quot;")+'"><input type="hidden" name="extension" value="'+t+'"><input type="hidden" name="mime-type" value="'+a+'"><input type="hidden" name="filename" value="'+f(!0)+'"><input type="hidden" name="data-url" value="'+(i||!1)+'"></form>',n.body.appendChild(r),r.firstChild.submit(),n.body.removeChild(r))},y=function(t){switch(S=e.getText(),t){case"txt":v(S,"txt","text/plain");break;case"html":v(e.getHTML(),"html","text/html");break;case"pdf":u(),v(u(),"pdf","application/pdf",!0)}},x=function(t){for(var n,a;L.firstChild;)L.removeChild(L.firstChild);if(t)for(n=e.convert(t),a=n.length;a--;)L.insertBefore(n[a],L.firstChild);else e.newline()},E=function(e){if(!FileReader)return void h(s("feature-not-supported"));var t,n=new FileReader,a=e.name.split(".").pop().toUpperCase();"text/plain"===e.type||"MD"===a||"MARKDOWN"===a?(n.onload=function(){t=n.result,p()?h(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){x(t)}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){y("txt"),x(t)},className:"button--active"}]):x(t)},n.readAsText(e)):h(s("file-type-not-supported"))},b=function(t,n,a){var i=new XMLHttpRequest;S=e.getText(),i.open("POST","server/mail.php",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onload=function(){4===i.readyState&&200===i.status&&h(s("success"===i.responseText?"mail-sent":"mail-error"))},i.send("address="+t+"&subject="+(encodeURIComponent(n)||s("mail-default-subject"))+"&message="+(encodeURIComponent(a)||s("mail-default-message"))+"\n\n---\n"+s("mail-footnote")+"&attachment="+encodeURIComponent(S)+"&filename="+f(!0))},e.init(L),a("languages/languages.json",function(e){for(var t,i=JSON.parse(e),r=navigator.onLine?localStorage.languageFile:i[0].file,o=n.getElementById("ui-languages-list"),l=i.length,s=n.createDocumentFragment(),d=function(){var e=this;a(e.getAttribute("data-file"),function(t){localStorage.languageFile=e.getAttribute("data-file"),localStorage.languageDictionary=e.getAttribute("data-dictionary"),N=JSON.parse(t),c()})};l--;)t=n.createElement("li"),t.setAttribute("data-file",i[l].file),t.setAttribute("data-dictionary",i[l].dictionary||""),t.textContent=i[l].name,t.addEventListener("click",d,!1),s.insertBefore(t,s.firstChild),r||-1===i[l].identifiers.indexOf((navigator.language||navigator.userLanguage).toLowerCase())&&l||(localStorage.languageFile=r=i[l].file,localStorage.languageDictionary=i[l].dictionary);o.insertBefore(s,o.firstChild),a(r,function(e){N=JSON.parse(e),c()})}),a("themes/themes.json",function(a){var i,r=JSON.parse(a),s=navigator.onLine?r.length:1,c=n.createDocumentFragment(),d=n.createElement("link"),u=function(){var e=this;localStorage.themeFile=e.getAttribute("data-file"),localStorage.themeUi=e.getAttribute("data-ui"),n.getElementById("theme").href=localStorage.themeFile,l(w,"ui-"+("dark"===localStorage.themeUi?"light":"dark")),o(w,"ui-"+localStorage.themeUi),e.parentNode.getElementsByClassName("active-theme")[0].removeAttribute("class"),e.className="active-theme"},g=function(){o(w,"ui-"+localStorage.themeUi),localStorage.saveState&&"<br>"!==localStorage.saveState?x(localStorage.saveState):e.newline(),d.removeEventListener("load",g,!1)};for(localStorage.themeFile&&navigator.onLine||(localStorage.themeFile=r[0].folder+"theme.css",localStorage.themeUi=r[0].ui),d.id="theme",d.rel="stylesheet",d.href=localStorage.themeFile,d.addEventListener("load",g,!1),n.head.appendChild(d);s--;)i=n.createElement("li"),i.setAttribute("data-file",r[s].folder+"theme.css"),i.setAttribute("data-fonts",r[s].fonts.join(",")),i.setAttribute("data-ui",r[s].ui),i.style.backgroundImage='url("'+r[s].folder+"preview"+(navigator.onLine&&t.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx)").matches?"@2x":"")+'.png")',i.textContent=r[s].name,i.getAttribute("data-file")===localStorage.themeFile&&(i.className="active-theme"),i.addEventListener("click",u,!1),c.insertBefore(i,c.firstChild);n.getElementById("ui-themes-list").appendChild(c)}),t.addEventListener("unload",function(){localStorage.saveState=e.getText()},!1),navigator.onLine||o(n.body,"offline"),t.addEventListener("offline",function(){o(n.body,"offline")},!1),t.addEventListener("online",function(){l(n.body,"offline")},!1),T.addEventListener("click",function(e){if(navigator.onLine||!r(e.target,"online-only"))if(e.target.id)switch(l(w.parentNode,"frame--show-file"),e.target.id){case"ui-export-txt":y("txt");break;case"ui-export-html":y("html");break;case"ui-export-pdf":setTimeout(function(){y("pdf")},300);break;case"ui-new":p()?h(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){x()}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){y("txt"),x()},className:"button--active"}]):x();break;case"ui-mail":h('<label class="font-caps" for="ui-mail-email">'+s("mail-address")+'</label><input id="ui-mail-email" class="font-helvetica font-size-regular" type="email" value="'+(localStorage.email||"")+'"><label class="font-caps" for="ui-mail-subject">'+s("mail-subject")+'</label><input id="ui-mail-subject" class="font-helvetica font-size-regular" type="email"><label class="font-caps" for="ui-mail-message">'+s("mail-text")+'</label><textarea id="ui-mail-message" class="font-helvetica font-size-regular"></textarea>',[{text:s("cancel")},{text:s("send"),clickHandler:function(e){var t=n.getElementById("ui-mail-email");/\S+@\S+\.\S+/.test(t.value)?(l(t,"validation-error"),localStorage.email=t.value,b(t.value,n.getElementById("ui-mail-subject").value,n.getElementById("ui-mail-message").value)):(e.stopImmediatePropagation(),o(t,"validation-error"))},className:"button--active"}]);break;case"ui-about":p()?h(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){x(s("about-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){y("txt"),x(s("about-text"))},className:"button--active"}]):x(s("about-text"))}else if(r(e.target,"menu__sublist"))if(e.target.style.height)e.target.removeAttribute("style");else{var t=this.querySelector("[style]");t&&t.removeAttribute("style"),e.target.style.height=52*(e.target.lastElementChild.children.length+1)+"px"}},!1),n.getElementById("ui-custom-theme").addEventListener("click",function(){l(w.parentNode,"frame--show-themes"),p()?h(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){x(s("create-a-custom-theme-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){y("txt"),x(s("create-a-custom-theme-text"))},className:"button--active"}]):x(s("create-a-custom-theme-text"))},!1),n.getElementById("ui-themes-filter").addEventListener("input",function(){for(var e=this,t=e.nextElementSibling,n=t.children.length,a=0;n--;)-1!==t.children[n].textContent.toLowerCase().indexOf(e.value.toLowerCase())||-1!==t.children[n].getAttribute("data-fonts").toLowerCase().indexOf(e.value.toLowerCase())?(t.children[n].style.display="block",a++):t.children[n].style.display="none";t.nextElementSibling.style.display=a?"none":"block"},!1),n.getElementById("ui-open").addEventListener("change",function(){E(this.files[0]),this.parentNode.reset()},!1),n.addEventListener("dragover",function(e){"TEXTAREA"!==e.target.tagName&&e.preventDefault()},!1),n.addEventListener("dragenter",function(e){"TEXTAREA"!==e.target.tagName&&o(L,"dragover")},!1),n.addEventListener("dragleave",function(e){e.target===L&&l(L,"dragover")},!1),n.addEventListener("drop",function(t){if("TEXTAREA"!==t.target.tagName){t.preventDefault();var n,a,i;t.dataTransfer.files[0]?E(t.dataTransfer.files[0]):(i=t.dataTransfer.getData("URL")||t.dataTransfer.getData("TEXT"),a=L.getElementsByTagName("TEXTAREA")[0]||L,i&&(n=i.split(".").pop().toUpperCase(),n.match(/BMP|GIF|JPG|JPEG|PNG|SVG/)&&(i="![]("+i+")"),"TEXTAREA"===a.tagName?a.value+=i:e.newline(i))),l(L,"dragover")}},!1),L.addEventListener("select",function(e){if(localStorage.languageDictionary&&"TEXTAREA"===e.target.tagName){var r=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd).trim();(r.match(/\s/g)||[]).length<2&&r.length>1&&r.length<20&&a("server/sinonimi/service.php?word="+encodeURIComponent(r)+"&language="+localStorage.languageDictionary+"&output=json",function(a){if(a=JSON.parse(a),a.response){var r,s,c={},d=g(e.target),u=function(){l(H.parentNode,"fade-in--show"),n.removeEventListener("keydown",u,!1),n.removeEventListener("mouseup",u,!1),n.removeEventListener("drop",u,!1),L.removeEventListener("scroll",u,!1)},m=a.response.length,f="";for(s=0;m>s;s++)c.hasOwnProperty(a.response[s].list.category)||(c[a.response[s].list.category]=[]),c[a.response[s].list.category]=i(c[a.response[s].list.category].concat(a.response[s].list.synonyms.replace(/\s\(\w+\)/g,"").split("|")));f+='<div class="tooltip__container scroll">';for(r in c)c.hasOwnProperty(r)&&(f+='<span class="tooltip__category font-caps">'+r.replace(/[\(\)]/g,"")+"</span>",f+='<ul class="font-size-medium no-bullets"><li>'+c[r].join("</li><li>")+"</li></ul>");f+="</div>",n.addEventListener("keydown",u,!1),n.addEventListener("mouseup",u,!1),n.addEventListener("drop",u,!1),L.addEventListener("scroll",u,!1),H.innerHTML=f,H.style.left=d.left+d.width/2-H.offsetWidth/2+"px",d.top+H.offsetHeight+50>t.innerHeight?(o(H,"tooltip--top"),H.style.top=d.top-d.height-H.offsetHeight+"px"):(l(H,"tooltip--top"),H.style.top=d.top+d.height+"px"),o(H.parentNode,"fade-in--show")}})}},!1),H.addEventListener("mouseup",function(e){var t,n;"LI"===e.target.tagName&&(t=L.getElementsByTagName("TEXTAREA")[0],n=t.selectionStart,t.value=t.value.substring(0,n)+e.target.textContent+t.value.substring(t.selectionEnd),t.setSelectionRange(n+e.target.textContent.length,n+e.target.textContent.length))},!1),t.hasOwnProperty("ontouchstart")||navigator.msMaxTouchPoints?(o(n.body,"touch"),n.addEventListener("touchstart",function(e){A.x=e.changedTouches[0].pageX,A.y=e.changedTouches[0].pageY},!1),n.addEventListener("touchend",function(e){var t=A.x-e.changedTouches[0].pageX,n=A.y-e.changedTouches[0].pageY;Math.abs(t)>Math.abs(n)&&(t>0?r(w.parentNode,"frame--show-file")?l(w.parentNode,"frame--show-file"):o(w.parentNode,"frame--show-themes"):r(w.parentNode,"frame--show-themes")?l(w.parentNode,"frame--show-themes"):o(w.parentNode,"frame--show-file"))},!1)):(o(n.body,-1!==navigator.appVersion.indexOf("Mac")?"os-mac":"os-other"),T.addEventListener("mouseenter",function(){var e=m();n.getElementById("ui-counter-characters").textContent=e.characters,n.getElementById("ui-counter-words").textContent=e.words,o(w.parentNode,"frame--show-file")},!1),T.addEventListener("mouseleave",function(){var e=this.querySelector("[style]");e&&e.removeAttribute("style"),l(w.parentNode,"frame--show-file")},!1),k.addEventListener("mouseenter",function(){o(w.parentNode,"frame--show-themes")},!1),k.addEventListener("mouseleave",function(){l(w.parentNode,"frame--show-themes")},!1),n.addEventListener("mousemove",function(){F||(o(w.parentNode,"mouse-moved"),F=!0),clearTimeout(C),C=setTimeout(function(){l(w.parentNode,"mouse-moved"),F=!1},1e3)},!1),n.addEventListener("keydown",function(e){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case 69:e.preventDefault(),y(e.altKey?"html":e.shiftKey?"pdf":"txt");break;case 68:e.preventDefault(),n.getElementById("ui-new").click();break;case 77:e.preventDefault(),n.getElementById("ui-mail").click();break;case 83:e.preventDefault(),h(s("save-notification"))}},!1))}(Mark,window,document);