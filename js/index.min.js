!function(e,t,n){"use strict";var a,i,r,o,l,s,d,c,u,m,f,g,p,h,v,y,E,x,b,L,N,w=n.getElementById("mark"),C=n.getElementById("ui"),T=n.getElementById("ui-file"),k=n.getElementById("ui-themes"),S=n.getElementById("ui-tooltip"),B=!1,A={};a=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){"function"==typeof t&&4===n.readyState&&200===n.status&&t(n.responseText)},n.send()},i=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},n.documentElement.classList?(r=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},l=function(e,t){e.classList.remove(t)}):(r=function(e,t){return RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},o=function(e,t){r(e,t)||(e.className+=(e.className?" ":"")+t)},l=function(e,t){e.className=e.className.replace(RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),"")}),s=function(e){return b[e]},d=function(){for(var e=C.querySelectorAll("[data-l18n]"),t=e.length;t--;)"INPUT"===e[t].tagName?e[t].placeholder=s(e[t].getAttribute("data-l18n")):(e[t].firstChild&&3===e[t].firstChild.nodeType&&e[t].removeChild(e[t].firstChild),e[t].insertBefore(n.createTextNode(s(e[t].getAttribute("data-l18n"))),e[t].firstChild))},c=function(t){var n,a;n=new jsPDF,a=w.getElementsByTagName("textarea")[0],a&&(a=e.render(a)),n.addHTML(w,function(){t.call(void 0,n.output("datauristring")),a&&e.unrender(a)})},u=function(t){var n;n=w.getElementsByTagName("textarea")[0],n&&(n=e.render(n)),html2canvas(w,{onrendered:function(a){t.call(void 0,a.toDataURL()),n&&e.unrender(n)}})},m=function(e){if("TEXTAREA"===e.tagName&&e.selectionStart!==e.selectionEnd){var t,a=n.createElement("div"),i=e.value;return i=i.substring(0,e.selectionStart)+'<span id="selection-rect">'+i.substring(e.selectionStart,e.selectionEnd)+"</span>"+i.substring(e.selectionEnd),a.innerHTML=i.replace(/\n/g,"<br>"),a.className=e.className,e.parentNode.insertBefore(a,e),t=n.getElementById("selection-rect").getBoundingClientRect(),e.parentNode.removeChild(a),t}},f=function(){var t,a,i,r=n.createElement("div");for(r.innerHTML=e.getHTML(),t=r.getElementsByTagName("br"),i=t.length;i--;)t[i].parentNode.replaceChild(n.createTextNode("\n"),t[i]);return a=r.textContent,{characters:a.replace(/\n/g,"").length,words:a.split(/[\s\n]/).filter(function(e){return""!==e}).length}},g=function(e,t){var a,i,r,s=n.getElementById("ui-"+(t?"modal":"notice")),d=function(e){e&&"keydown"===e.type&&27!==e.keyCode||(l(s,"fade-in--show"),n.removeEventListener("keydown",d,!1))},c=s.firstElementChild.firstElementChild,u=s.firstElementChild.lastElementChild;if(c.innerHTML=e,o(s,"fade-in--show"),t){for(a=n.createDocumentFragment();u.firstChild;)u.removeChild(u.firstChild);for(r=t.length;r--;)i=n.createElement("button"),i.textContent=t[r].text,t[r].className&&(i.className=t[r].className),t[r].clickHandler&&i.addEventListener("click",t[r].clickHandler,!1),i.addEventListener("click",d,!1),a.insertBefore(i,a.firstChild);u.appendChild(a),n.addEventListener("keydown",d,!1)}else s.addEventListener("click",d,!1),setTimeout(d,8e3);return s},p=function(){var t=e.getText();return"<br>"!==t&&L!==t},h=function(e,t,a,i){var r=n.createElement("a");void 0!==r.download?(r.href=i?e:"data:"+a+";charset=utf-8,"+encodeURIComponent(e),r.download=s("export-filename")+"."+t,n.body.appendChild(r),r.click(),n.body.removeChild(r)):navigator.onLine&&(r.innerHTML='<form method="POST" action="server/download-fallback.php"><input type="hidden" name="content" value="'+e+'"><input type="hidden" name="extension" value="'+t+'"><input type="hidden" name="mime-type" value="'+a+'"><input type="hidden" name="filename" value="'+s("export-filename")+'"><input type="hidden" name="data-url" value="'+(i||!1)+'"></form>',r.firstChild.submit())},v=function(t){switch(L=e.getText(),t){case"txt":h(L,"txt","text/plain");break;case"html":h(e.getHTML(),"html","text/html");break;case"pdf":c(function(e){h(e,"pdf","application/pdf",!0)});break;case"png":u(function(e){h(e,"png","image/png",!0)})}},y=function(t){for(var n,a;w.firstChild;)w.removeChild(w.firstChild);if(t)for(n=e.convert(t),a=n.length;a--;)w.insertBefore(n[a],w.firstChild);else e.newline()},E=function(e){if(!FileReader)return void g(s("feature-not-supported"));var t,n=new FileReader,a=e.name.split(".").pop().toUpperCase();"text/plain"===e.type||"MD"===a||"MARKDOWN"===a?(n.onload=function(){t=n.result,p()?g(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(t)}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(t)},className:"button--active"}]):y(t)},n.readAsText(e)):g(s("file-type-not-supported"))},x=function(t,n){var a=new XMLHttpRequest;L=e.getText(),a.open("POST","server/mail.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.onload=function(){4===a.readyState&&200===a.status&&g(s("success"===a.responseText?"mail-sent":"mail-error"))},a.send("address="+t+"&message="+(encodeURIComponent(n)||s("mail-default-message"))+"\n\n---\n"+s("mail-footnote")+"&attachment="+encodeURIComponent(L)+"&subject="+s("mail-subject")+"&filename="+s("export-filename"))},e.init(w),a("languages/languages.json",function(e){for(var t,i=JSON.parse(e),r=navigator.onLine?localStorage.languageFile:i[0].file,o=n.getElementById("ui-languages-list"),l=i.length,s=n.createDocumentFragment(),c=function(){var e=this;a(e.getAttribute("data-file"),function(t){localStorage.languageFile=e.getAttribute("data-file"),localStorage.languageDictionary=e.getAttribute("data-dictionary"),b=JSON.parse(t),d()})};l--;)t=n.createElement("li"),t.setAttribute("data-file",i[l].file),t.setAttribute("data-dictionary",i[l].dictionary||""),t.textContent=i[l].name,t.addEventListener("click",c,!1),s.insertBefore(t,s.firstChild),r||-1===i[l].identifiers.indexOf((navigator.language||navigator.userLanguage).toLowerCase())&&l||(localStorage.languageFile=r=i[l].file,localStorage.languageDictionary=i[l].dictionary);o.insertBefore(s,o.firstChild),a(r,function(e){b=JSON.parse(e),d()})}),a("themes/themes.json",function(a){var i,r=JSON.parse(a),s=navigator.onLine?r.length:1,d=n.createDocumentFragment(),c=function(){var e=this;localStorage.themeFile=e.getAttribute("data-file"),localStorage.themeUi=e.getAttribute("data-ui"),n.getElementById("theme").href=localStorage.themeFile,l(C,"ui-"+("dark"===localStorage.themeUi?"light":"dark")),o(C,"ui-"+localStorage.themeUi),e.parentNode.getElementsByClassName("active-theme")[0].removeAttribute("class"),e.className="active-theme"},u=n.createElement("link");for(localStorage.themeFile&&navigator.onLine||(localStorage.themeFile=r[0].folder+"theme.css",localStorage.themeUi=r[0].ui),u.id="theme",u.rel="stylesheet",u.href=localStorage.themeFile,u.addEventListener("load",function(){o(C,"ui-"+localStorage.themeUi),localStorage.saveState&&"<br>"!==localStorage.saveState?y(localStorage.saveState):e.newline()},!1),n.head.appendChild(u);s--;)i=n.createElement("li"),i.setAttribute("data-file",r[s].folder+"theme.css"),i.setAttribute("data-fonts",r[s].fonts.join(",")),i.setAttribute("data-ui",r[s].ui),i.style.backgroundImage='url("'+r[s].folder+"preview"+(navigator.onLine&&t.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx)").matches?"@2x":"")+'.png")',i.textContent=r[s].name,i.getAttribute("data-file")===localStorage.themeFile&&(i.className="active-theme"),i.addEventListener("click",c,!1),d.insertBefore(i,d.firstChild);n.getElementById("ui-themes-list").appendChild(d)}),t.addEventListener("unload",function(){localStorage.saveState=e.getText()},!1),navigator.onLine||o(n.body,"offline"),t.addEventListener("offline",function(){o(n.body,"offline")},!1),t.addEventListener("online",function(){l(n.body,"offline")},!1),T.addEventListener("click",function(e){if(navigator.onLine||!r(e.target,"online-only"))if(e.target.id)switch(l(C.parentNode,"frame--show-file"),e.target.id){case"ui-export-txt":v("txt");break;case"ui-export-html":v("html");break;case"ui-export-pdf":setTimeout(function(){v("pdf")},300);break;case"ui-export-png":setTimeout(function(){v("png")},300);break;case"ui-new":p()?g(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y()}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y()},className:"button--active"}]):y();break;case"ui-mail":g('<label class="font-caps" for="ui-mail-email">'+s("mail-address")+'</label><input id="ui-mail-email" class="font-helvetica font-size-regular" type="email" value="'+(localStorage.email||"")+'"><label class="font-caps" for="ui-mail-message">'+s("mail-text")+'</label><textarea id="ui-mail-message" class="font-helvetica font-size-regular"></textarea>',[{text:s("cancel")},{text:s("send"),clickHandler:function(e){var t=n.getElementById("ui-mail-email");/\S+@\S+\.\S+/.test(t.value)?(l(t,"validation-error"),localStorage.email=t.value,x(t.value,n.getElementById("ui-mail-message").value)):(e.stopImmediatePropagation(),o(t,"validation-error"))},className:"button--active"}]);break;case"ui-about":p()?g(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(s("about-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(s("about-text"))},className:"button--active"}]):y(s("about-text"))}else r(e.target,"menu__sublist")?(o(e.target,"menu__sublist--display"),o(e.target.parentNode,"menu__list--display-sublist")):r(e.target,"menu__back")&&(l(e.target.parentNode.parentNode,"menu__sublist--display"),l(e.target.parentNode.parentNode.parentNode,"menu__list--display-sublist"))},!1),n.getElementById("ui-custom-theme").addEventListener("click",function(){l(C.parentNode,"frame--show-themes"),p()?g(s("delete-warning"),[{text:s("delete-text"),clickHandler:function(){y(s("create-a-custom-theme-text"))}},{text:s("cancel")},{text:s("export-text"),clickHandler:function(){v("txt"),y(s("create-a-custom-themen-text"))},className:"button--active"}]):y(s("create-a-custom-theme-text"))},!1),n.getElementById("ui-themes-filter").addEventListener("input",function(){for(var e=this,t=e.nextElementSibling,n=t.children.length,a=0;n--;)-1!==t.children[n].textContent.toLowerCase().indexOf(e.value.toLowerCase())||-1!==t.children[n].getAttribute("data-fonts").toLowerCase().indexOf(e.value.toLowerCase())?(t.children[n].style.display="block",a++):t.children[n].style.display="none";t.nextElementSibling.style.display=a?"none":"block"},!1),n.getElementById("ui-open").addEventListener("change",function(){E(this.files[0]),this.parentNode.reset()},!1),n.addEventListener("dragover",function(e){e.preventDefault()},!1),n.addEventListener("dragenter",function(){o(w,"dragover")},!1),n.addEventListener("dragleave",function(e){e.target===w&&l(w,"dragover")},!1),n.addEventListener("drop",function(t){t.preventDefault();var n,a,i;t.dataTransfer.files[0]?E(t.dataTransfer.files[0]):(i=t.dataTransfer.getData("URL")||t.dataTransfer.getData("TEXT"),a=w.getElementsByTagName("TEXTAREA")[0]||w,i&&(n=i.split(".").pop().toUpperCase(),("BMP"===n||"GIF"===n||"JPG"===n||"JPEG"===n||"PNG"===n||"SVG"===n)&&(i="![]("+i+")"),"TEXTAREA"===a.tagName?a.value+=i:e.newline(i))),l(w,"dragover")},!1),w.addEventListener("select",function(e){if(localStorage.languageDictionary&&"TEXTAREA"===e.target.tagName){var r=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd).trim();(r.match(/\s/g)||[]).length<2&&r.length>1&&r.length<20&&a("server/sinonimi/service.php?word="+encodeURIComponent(r)+"&language="+localStorage.languageDictionary+"&output=json",function(a){if(a=JSON.parse(a),a.response){var r,s,d={},c=m(e.target),u=function(){l(S.parentNode,"fade-in--show"),n.removeEventListener("keydown",u,!1),n.removeEventListener("mouseup",u,!1),n.removeEventListener("drop",u,!1),w.removeEventListener("scroll",u,!1)},f=a.response.length,g="";for(s=0;f>s;s++)d.hasOwnProperty(a.response[s].list.category)||(d[a.response[s].list.category]=[]),d[a.response[s].list.category]=i(d[a.response[s].list.category].concat(a.response[s].list.synonyms.replace(/\s\(\w+\)/g,"").split("|")));g+='<div class="tooltip__container scroll">';for(r in d)d.hasOwnProperty(r)&&(g+='<span class="tooltip__category font-caps">'+r.replace(/[\(\)]/g,"")+"</span>",g+='<ul class="font-size-medium no-bullets"><li>'+d[r].join("</li><li>")+"</li></ul>");g+="</div>",n.addEventListener("keydown",u,!1),n.addEventListener("mouseup",u,!1),n.addEventListener("drop",u,!1),w.addEventListener("scroll",u,!1),S.innerHTML=g,S.style.left=c.left+c.width/2-S.offsetWidth/2+"px",c.top+S.offsetHeight+50>t.innerHeight?(o(S,"tooltip--top"),S.style.top=c.top-c.height-S.offsetHeight+"px"):(l(S,"tooltip--top"),S.style.top=c.top+c.height+"px"),o(S.parentNode,"fade-in--show")}})}},!1),S.addEventListener("mouseup",function(e){var t,n;"LI"===e.target.tagName&&(t=w.getElementsByTagName("TEXTAREA")[0],n=t.selectionStart,t.value=t.value.substring(0,n)+e.target.textContent+t.value.substring(t.selectionEnd),t.setSelectionRange(n+e.target.textContent.length,n+e.target.textContent.length))},!1),t.hasOwnProperty("ontouchstart")||navigator.msMaxTouchPoints?(o(n.body,"touch"),n.addEventListener("touchstart",function(e){A.x=e.changedTouches[0].pageX,A.y=e.changedTouches[0].pageY},!1),n.addEventListener("touchend",function(e){var t=A.x-e.changedTouches[0].pageX,n=A.y-e.changedTouches[0].pageY;Math.abs(t)>Math.abs(n)&&(t>0?r(C.parentNode,"frame--show-file")?l(C.parentNode,"frame--show-file"):o(C.parentNode,"frame--show-themes"):r(C.parentNode,"frame--show-themes")?l(C.parentNode,"frame--show-themes"):o(C.parentNode,"frame--show-file"))},!1)):(o(n.body,-1!==navigator.appVersion.indexOf("Mac")?"os-mac":"os-other"),T.addEventListener("mouseenter",function(){var e=f();n.getElementById("ui-counter-characters").textContent=e.characters,n.getElementById("ui-counter-words").textContent=e.words,o(C.parentNode,"frame--show-file")},!1),T.addEventListener("mouseleave",function(){var e=this.getElementsByClassName("menu__list--display-sublist")[0];e&&(l(e,"menu__list--display-sublist"),l(e.getElementsByClassName("menu__sublist--display")[0],"menu__sublist--display")),l(C.parentNode,"frame--show-file")},!1),k.addEventListener("mouseenter",function(){o(C.parentNode,"frame--show-themes")},!1),k.addEventListener("mouseleave",function(){l(C.parentNode,"frame--show-themes")},!1),n.addEventListener("mousemove",function(){B||(o(C.parentNode,"mouse-moved"),B=!0),clearTimeout(N),N=setTimeout(function(){l(C.parentNode,"mouse-moved"),B=!1},1e3)},!1),n.addEventListener("keydown",function(e){if(e.metaKey||e.ctrlKey)switch(e.keyCode){case 69:e.preventDefault(),v(e.altKey&&e.shiftKey?"png":e.altKey?"html":e.shiftKey?"pdf":"txt");break;case 68:e.preventDefault(),n.getElementById("ui-new").click();break;case 77:e.preventDefault(),n.getElementById("ui-mail").click();break;case 83:e.preventDefault(),g(s("save-notification"))}},!1))}(Mark,window,document);